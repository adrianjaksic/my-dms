(function(n,t,i){function f(t){var f=e.contains(null,t.Ekstenzija),i="",r="",u="";return t.Obrisan&&(u="obrisan"),f!==!1&&(r='data-slika="true"'),i+='<div class="dmsFile '+u+'" style="background-image: url('+n.icoPath+t.Ekstenzija+'.gif)" data-id="'+t.IdDokumenta+'" '+r+' data-link="" data-linkSlike="" data-ext="'+t.Ekstenzija+'">',i+='<div class="red"><span class="qTdPopupDokumenti" data-idDok="'+t.IdDokumenta+'" data-idPredDok="'+n.vm.IdPredmeta+'">'+qKonverzija.VratiLokalizovaniTekst(qUtils.SliceFileName(t.Naziv,33))+"<\/i><\/div>",i+='<div class="red">',t.Obrisan?n.vm.DozvoljenoVracanjeObrisanog&&(i+='<a class="undoDel" href="#">'+qKonverzija.VratiLokalizovaniTekst("Vrati obrisani")+"<\/a>"):i+='<a class="del" href="#">'+qKonverzija.VratiLokalizovaniTekst("Obriši")+"<\/a>",i+="<\/div>",i+"<\/div>"}function o(){var r="",u=n.vm.Dokumenti.length,i,e;if(u==0)t("#dmsFilesWrap").empty();else{for(i=0;i<u;i++)e=n.vm.Dokumenti[i],r+=f(e);t("#dmsFilesWrap").html(r)}}function s(n){var r=f(n),i;t("#dmsFilesWrap").append(t(r).hide().fadeIn());i=t("#dmsFilesWrap").height()+t("#dmsFilesWrap").find(".dmsFile").length*32;t("#dmsFilesWrap").scrollTop(i)}function h(i,u){if(r)return!1;var f=i.attr("data-id");return t.ajax({type:"POST",url:"Dms/ObrisiDokument",data:{idPredmeta:n.vm.IdPredmeta,idDokumenta:f,razlogBrisanja:u},success:function(r){var f,u;if(r.Greska){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),r.Poruka,"greska");return}i.addClass("obrisan");i.find(".del").remove();n.vm.DozvoljenoVracanjeObrisanog&&(f='<a class="undoDel" href="#">'+qKonverzija.VratiLokalizovaniTekst("Vrati obrisani")+"<\/a>",i.find(".red:eq(1)").html(f));t("#dmsPrikaziObrisane").prop("checked")?(i.show(),t("#dmsDesno").show()):(i.hide(),i.removeClass("kliknut"),t("#dmsDesno").hide(),u=t("#dmsWrap").find("#dmsDesno"),u.find("iframe").remove(),u.find("#dmsTxtWrap").remove(),u.find("#dmsPdfWrap").remove(),u.find("#dmsImg").remove(),u.find("#dmsPorukaZaZoom").hide())}}),!1}var e=["jpg","jpeg","png","gif","bmp"],u,r;n.icoPath=i;n.uploader=i;n.vm=i;n.url_VratiLinkDokumentaPredmeta=i;n.url_VratiObrisaniDokument=i;n.url_SnimiAktivnostPredmeta=i;u=0;r=!1;n.InitUI=function(n){n?(r=!0,t("#dmsWrap").addClass("ro")):(r=!1,t("#dmsWrap").removeClass("ro"))};n.InitUploader=function(){n.uploader=new qq.FineUploader({element:document.getElementById("dmsBrowse"),request:{endpoint:"Dms/UploadDokumenta",params:{idPredmeta:n.vm.IdPredmeta}},autoUpload:!1,text:{uploadButton:qKonverzija.VratiLokalizovaniTekst("Odaberi fajlove"),cancelButton:qKonverzija.VratiLokalizovaniTekst("Ukloni"),waitingForResponse:qKonverzija.VratiLokalizovaniTekst("Učitavanje")},template:'<div class="qq-uploader"><div class="qq-upload-drop-area" style="display: none;"><span>{dragZoneText}<\/span><\/div><div class="qq-upload-button" style="position: relative; overflow: hidden; direction: ltr;"><div><span class="ubt">{uploadButtonText}<\/span><\/div><\/div><ul class="qq-upload-list"><\/ul><\/div>',validation:{allowedExtensions:n.vm.DozvoljeneEkstenzije,sizeLimit:n.vm.MaksimalnaVelicina*1024,stopOnFirstInvalidFile:!1},failedUploadTextDisplay:{mode:"custom",maxChars:40,responseProperty:"error",enableTooltip:!0},callbacks:{onComplete:function(n,t,i){u--;i.error||s(i.file)},onSubmit:function(n,t){log(t);u++}}});o()};n.HendlujClickVratiObrisani=function(i){if(r)return!1;var u=i.parent().parent();t.ajax({type:"POST",url:n.url_VratiObrisaniDokument,data:{idPredmeta:n.vm.IdPredmeta,idDokumenta:u.attr("data-id")},success:function(n){if(n.Greska){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),n.Poruka,"greska");return}u.removeClass("obrisan");var t='<a class="del" href="#">'+qKonverzija.VratiLokalizovaniTekst("Obriši")+"<\/a>";u.find(".red:eq(1)").html(t);i.remove()},complete:function(){}})};n.UploadStoredFiles=function(){r||n.uploader.uploadStoredFiles()};n.HendlujClickObrisi=function(n){if(r)return!1;var u=n.parent().parent(),f="<div>                        <div>"+qKonverzija.VratiLokalizovaniTekst("Unesite razlog brisanja dokumenta")+':<\/div>                        <div class="unosRed">                            <div class="unosRedVr" style="width: 90%; margin-left: 5%; margin-right: 5%;"><input class="myInput" style="width: 100%;" id="dmsRazlogBrisanja"/><\/div>                        <\/div>                    <\/div>';PrikaziProzor2(!0,!0,qKonverzija.VratiLokalizovaniTekst("BRISANJE DOKUMENTA"),f,"difolt",[{labela:qKonverzija.VratiLokalizovaniTekst("Obriši"),callback:function(){var n=t("#dmsRazlogBrisanja"),r=n.val().trimnull();if(r==i){qUtils.BlinkiBGColorElementa(n,"red",null,"white");n.focus();return}h(u,r);PrikaziProzor2(!1)}},{labela:qKonverzija.VratiLokalizovaniTekst("Zatvori"),callback:function(){PrikaziProzor2(!1)}}])};n.PrikaziDmsDijalog=function(i,r){t("#dmsPorukaZaZoom").hide();t("#dmsWrap").show();t("#dmsLinkoviWrap").hide();t("#dmsWrap").find("iframe").remove();t("#dmsWrap").find("#dmsImg").remove();t("#dmsWrap").find("#dmsTxtWrap").remove();t("#dmsWrap").find("#dmsPdfWrap").remove();u=0;n.vm=i;n.InitUploader();n.InitUI(r)};n.HendlujPostaviKliknutFajl=function(){var u=t(this),o,h,l,a,v,y,p,w;if(!u.hasClass("kliknut")){t.ajax({type:"POST",url:n.url_SnimiAktivnostPredmeta,data:{idPredmeta:n.vm.IdPredmeta,naziv:u.find(".red:eq(0) span").text().trimnull()},success:function(n){if(n.Greska){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),n.Poruka,"greska");return}},complete:function(){}});var c=u.attr("data-slika"),s=u.attr("data-ext"),r=u.attr("data-link").trimnull(),f=u.attr("data-linkSlike").trimnull(),e=t("#dmsWrap").find("#dmsDesno");e.find("iframe").remove();e.find("#dmsTxtWrap").remove();e.find("#dmsPdfWrap").remove();e.find("#dmsImg").remove();o=e.find("#dmsPorukaZaZoom");o.hide();t("#dmsLinkoviWrap").hide();t(".dmsFile").removeClass("kliknut");u.addClass("kliknut");r==i?t.ajax({type:"GET",url:n.url_VratiLinkDokumentaPredmeta,data:{idPredmeta:n.vm.IdPredmeta,idDokumenta:u.attr("data-id")},success:function(n){var h,l,a,v,y,p,w;if(n.Greska){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),n.Poruka,"greska");return}if(f=n.Data,f==i){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),qKonverzija.VratiLokalizovaniTekst("Fajl je obrisan."),"greska");return}r=f.startsWith("/")?window.location.origin+f:window.location.origin+"/"+f;u.attr("data-link",r);u.attr("data-linkSlike",f);h="";t("#dmsLinkoviWrap").find("a.link").attr("href",r);c==="true"?(t("#dmsLinkoviWrap").find("a.pregledaj").hide(),l='<img id="dmsImg" src="'+f+'"/>',t("#dmsDesnoDonjiRed").before(l),wheelzoom(document.querySelector("img#dmsImg")),o.show()):(o.hide(),s=="txt"?(a='<div id="dmsTxtWrap" style="height: 100%"><object type="text/plain" data="'+r+'" border="0" style="width: 100%; height: 100%;"><\/object><\/div>',t("#dmsDesnoDonjiRed").before(a)):s=="pdf"?(v='<div id="dmsPdfWrap" style="height: 100%"><\/div>',t("#dmsDesnoDonjiRed").before(v),y={url:r,pdfOpenParams:{view:"FitV"}},p=new PDFObject(y),p.embed("dmsPdfWrap")):(h="https://docs.google.com/gview?url="+r+"&embedded=true",w='<iframe frameborder="0" src='+h+"><\/iframe>",t("#dmsDesnoDonjiRed").before(w)),t("#dmsLinkoviWrap").find("a.pregledaj").attr("href","https://docs.google.com/viewer?url="+r),t("#dmsLinkoviWrap").find("a.pregledaj").show());t("#dmsLinkoviWrap").show();e.show()},complete:function(){}}):(t("#dmsLinkoviWrap").find("a.link").attr("href",r),h="",c==="true"?(t("#dmsLinkoviWrap").find("a.pregledaj").hide(),l='<img id="dmsImg" src="'+f+'"/>',t("#dmsDesnoDonjiRed").before(l),wheelzoom(document.querySelector("img#dmsImg")),o.show()):(o.hide(),s=="txt"?(a='<div id="dmsTxtWrap" style="height: 100%"><object type="text/plain" data="'+r+'" border="0" style="width: 100%; height: 100%;"><\/object><\/div>',t("#dmsDesnoDonjiRed").before(a)):s=="pdf"?(v='<div id="dmsPdfWrap" style="height: 100%"><\/div>',t("#dmsDesnoDonjiRed").before(v),y={url:r,pdfOpenParams:{view:"FitV"}},p=new PDFObject(y),p.embed("dmsPdfWrap")):(h="https://docs.google.com/gview?url="+r+"&embedded=true",w='<iframe frameborder="0" src='+h+"><\/iframe>",t("#dmsDesnoDonjiRed").before(w)),t("#dmsLinkoviWrap").find("a.pregledaj").attr("href","https://docs.google.com/viewer?url="+r),t("#dmsLinkoviWrap").find("a.pregledaj").show()),t("#dmsLinkoviWrap").show(),e.show())}};n.HendlujPrikazFajlaPrekoCursora=function(n){var r=t("#dmsWrap").find("#dmsFilesWrap").find(".kliknut"),u=t("#dmsWrap").find("#dmsFilesWrap").find(".dmsFile").length,i,f,e;if(u>0)if(r&&r.length>0)if(i=r.index(),n)if(i>0)f=i-1,t("#dmsWrap").find("#dmsFilesWrap").find(".dmsFile:eq("+f+")").click();else return;else if(i!=u-1)e=i+1,t("#dmsWrap").find("#dmsFilesWrap").find(".dmsFile:eq("+e+")").click();else return;else t("#dmsWrap").find("#dmsFilesWrap").find(".dmsFile:eq(0)").click()}})(window.qDms=window.qDms||{},jQuery);