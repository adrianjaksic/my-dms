(function(n,t,i){function p(n){var t,u,e;for(t in f)if(t!==i&&f[t]!==""){if(u=0,t==1&&(u=2),e=r.getColumns()[r.getColumnIndex(t)],n[e.field]==i)return!1;if(u==0){if(!n[e.field].toLowerCase().contains(f[t].toLowerCase()))return!1}else if(u==2&&n[e.field]!=f[t].toDecimal())return!1}return!0}function w(n,t,r,u,f){return f.IdPredmeta!=i?'<i class="fa fa-reply link" data-id="'+f.IdPredmeta+'"><\/i>':""}function b(n,t,r,u,f){return f.IdPredmeta!=i?'<div class="qTdPopupPredmeti" data-idPredmeta="'+f.IdPredmeta+'">'+nonull(r)+"<\/div>":""}function o(n,t,i){return nonull(i)}function k(){t("#ppZapisnikKreatoriCmb").quiComboBox("clearSelection");t("#ppZapisnikDatum").quiDate("setDate",new Date);t("#ppZapisnikOrganiCmb").quiComboBox("clearSelection");t("#ppZapisnikNemaRez").hide();t("#ppZapisnikSlickGrid").empty();t("#ppZapisnikSlickGridPager").empty();f={};r=i}function d(){var n=t("#ppZapisnikBtnPretrazi").find("table"),u;if(!n.hasClass("teloDugmeIskljuceno")){if(u=t("#ppZapisnikDatum").quiDate("getJSONDateNoTZStringify"),u==i){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),qKonverzija.VratiLokalizovaniTekst("Datum nije izabran."),"greska");return}t("#ppZapisnikSlickGrid").empty();t("#ppZapisnikSlickGridPager").empty();r=i;f={};var s=t("#ppZapisnikOrganiCmb").quiComboBox("getSelectedItemData"),e=t("#ppZapisnikKlaseCmb").quiComboBox("getSelectedItemData"),h=i,o=t("#ppZapisnikJediniceCmb").quiComboBox("getSelectedItemData"),l=i;s==i&&(h=e,e=i,l=o,o=i);n.addClass("teloDugmeIskljuceno");t.ajax({type:"GET",url:c,data:{idOrgana:s,datumJ:u,idKreatora:t("#ppZapisnikKreatoriCmb").quiComboBox("getSelectedItemData"),idKlase:e,idJedinice:o,samoArhivirani:t("#ppZapisnikSamoArhivirani").prop("checked"),oznakaKlase:h,oznakaJedinice:l},success:function(n){if(n.Greska){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),n.Poruka,"greska");return}var i=n.Data;i&&i.length>0?(g(i),t("#ppZapisnikNemaRez").hide()):t("#ppZapisnikNemaRez").show()},complete:function(){n.removeClass("teloDugmeIskljuceno")}})}}function g(n){for(var l,s,h,a,v,c=[],e=0;e<n.length;++e)l=n[e],s=t.extend({},l),s.id=e,c.push(s);h=[{field:"IdPredmeta",name:"",id:0,width:30,sortable:!1,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd tac",formatter:w,customPolje:!0},{field:"BrojIstorijePredmeta",name:qKonverzija.VratiLokalizovaniTekst("Broj"),id:1,width:50,sortable:!1,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd",formatter:o},{field:"SifraPredmeta",name:qKonverzija.VratiLokalizovaniTekst("Šifra predmeta"),id:2,width:210,sortable:!0,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd",formatter:b},{field:"Podnosilac",name:qKonverzija.VratiLokalizovaniTekst("Podnosilac"),id:3,width:165,sortable:!0,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd",formatter:o},{field:"NazivInspektora",name:qKonverzija.VratiLokalizovaniTekst("Inspektor"),id:4,width:150,sortable:!0,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd",formatter:o},{field:"Sadrzaj",name:qKonverzija.VratiLokalizovaniTekst("Sadržaj"),id:5,width:240,sortable:!0,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd",formatter:o},{field:"OpisIstorijePredmeta",name:qKonverzija.VratiLokalizovaniTekst("Opis"),id:6,width:135,sortable:!0,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd",formatter:o},{field:"NapomenaIstorijePredmeta",name:qKonverzija.VratiLokalizovaniTekst("Napomena"),id:7,width:150,sortable:!0,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd",formatter:o}];u=new Slick.Data.DataView;r=new Slick.Grid("#ppZapisnikSlickGrid",u,h,y);r.setSelectionModel(new Slick.RowSelectionModel);a=new Slick.Controls.Pager(u,r,t("#ppZapisnikSlickGridPager"));v=new Slick.Controls.ColumnPicker(h,r,y);u.onRowCountChanged.subscribe(function(){r.updateRowCount();r.render()});u.onRowsChanged.subscribe(function(n,t){r.invalidateRows(t.rows);r.render()});t(r.getHeaderRow()).delegate(":input","change keyup",function(){var n=t(this).data("columnId");n!=null&&(f[n]=t.trim(t(this).val()),u.refresh())});r.onHeaderRowCellRendered.subscribe(function(n,i){if(t(i.node).empty(),i.column.id!=0&&i.column.id!=1){var r=t("<input type='text'>");r.data("columnId",i.column.id).val(f[i.column.id]);r.appendTo(i.node)}else t(i.node).addClass("no-filter")});r.onSort.subscribe(function(n,t){var r=function(n,r){var l=t.sortCol.field,e=t.sortAsc?1:-1,u=n[l],f=r[l],s,a,o,h,c;return u!=i&&f==i?1*e:u==i&&f!=i?-1*e:u==i&&f==i?0:(s=0,a=t.sortCol.id,a==1&&(s=1),s==1?o=(u==f?0:u>f?1:-1)*e:(h=u.toLowerCase(),c=f.toLowerCase(),o=(h==c?0:h>c?1:-1)*e),o!=0)?o:0};u.sort(r)});r.onClick.subscribe(function(n,i){var u=i.row;if(t(n.target).hasClass("link")){n.stopImmediatePropagation();var f=r.getDataItem(u),e="&idPredmeta="+f.IdPredmeta+"&close=true",o="#./Predmeti?tipDokumenta=3"+e;window.open(location.origin+o,"_blank")}});r.init();u.beginUpdate();u.setItems(c);u.setFilter(p);u.endUpdate()}function nt(){var u=t("#ppZapisnikBtnStampa").find("table"),s;if(!u.hasClass("teloDugmeIskljuceno")){var f=t("#ppZapisnikOrganiCmb").quiComboBox("getSelectedItemData"),n=t("#ppZapisnikKlaseCmb").quiComboBox("getSelectedItemData"),e=i,r=t("#ppZapisnikJediniceCmb").quiComboBox("getSelectedItemData"),o=i;f==i&&(e=n,n=i,o=r,r=i);s={datumJ:t("#ppZapisnikDatum").quiDate("getJSONDateNoTZStringify"),nazivOrgana:qKonverzija.KonvertujULatinicu(t("#ppZapisnikOrganiCmb").quiComboBox("getSelectedItemLabel")),nazivKlase:qKonverzija.KonvertujULatinicu(t("#ppZapisnikKlaseCmb").quiComboBox("getSelectedItemLabel")),nazivJedinice:qKonverzija.KonvertujULatinicu(t("#ppZapisnikJediniceCmb").quiComboBox("getSelectedItemLabel")),nazivKreatora:qKonverzija.KonvertujULatinicu(t("#ppZapisnikKreatoriCmb").quiComboBox("getSelectedItemLabel")),idOrgana:f,idKlase:n,idJedinice:r,idKreatora:t("#ppZapisnikKreatoriCmb").quiComboBox("getSelectedItemData"),samoArhivirani:t("#ppZapisnikSamoArhivirani").prop("checked"),oznakaKlase:e,oznakaJedinice:o};qStampa.PrikaziDijalogStampe(v,s,!1,!1,"POST");u.removeClass("teloDugmeIskljuceno")}}function tt(n){t.ajax({type:"GET",url:l,data:{idOrgana:n},success:function(n){if(n.Greska){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),n.Poruka,"greska");return}t("#ppZapisnikJediniceCmb").quiComboBox("setItemsFromBinding",n.Data,"Naziv","IdElementa")},complete:function(){}})}function it(n){t.ajax({type:"GET",url:a,data:{idOkruga:e.IdOkruga,idOrgana:n},success:function(n){if(n.Greska){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),n.Poruka,"greska");return}t("#ppZapisnikKlaseCmb").quiComboBox("setItemsFromBinding",n.Data,"Naziv","IdElementa")},complete:function(){}})}var e,s=300,h=400,c,l,a,v,f={},r,u,y={editable:!1,enableCellNavigation:!0,showHeaderRow:!0,headerRowHeight:30,explicitInitialization:!0,rowHeight:20};n.Init=function(){var p,n,o,y,w;e=qUtils.IzvuciVM();f={};r=i;u=i;c=t("#url_VratiPredmetePretrage").text();a=t("#url_VratiKlase").text();l=t("#url_VratiJedinice").text();v=t("#url_VratiStampePrimopredajnogZapisnika").text();p=t("#ppZapisnikKreatoriCmb");p.quiComboBox({width:s,listWidth:h,showX:!0});p.quiComboBox("setItemsFromBinding",e.Kreatori,"Naziv","IdElementa");n=t("#ppZapisnikOrganiCmb");n.quiComboBox({width:s,listWidth:h,showX:!0});n.quiComboBox("setItemsFromBinding",e.Organi,"Naziv","IdElementa");o=t("#ppZapisnikKlaseCmb");o.quiComboBox({width:s,listWidth:h,showX:!0});o.quiComboBox("setItemsFromBinding",e.Klase,"Naziv","IdElementa");y=t("#ppZapisnikJediniceCmb");y.quiComboBox({width:s,listWidth:h,showX:!0});y.quiComboBox("setItemsFromBinding",e.Jedinice,"Naziv","IdElementa");w=t("#ppZapisnikDatum");w.quiDate({width:s,showX:!0});n.on("select",function(){var t=n.quiComboBox("getSelectedItemData");y.quiComboBox("clearItems");o.quiComboBox("clearItems");it(t);tt(t)});t("#ppZapisnikBtnReset").click(k);t("#ppZapisnikBtnPretrazi").click(d);t("#ppZapisnikBtnStampa").click(nt);t(window).on("resize.slickgrid",function(){r!=i&&r.resizeCanvas()})}})(window.qPrimopredajniZapisnik=window.qPrimopredajniZapisnik||{},jQuery),function(n,t,i){function w(n){var t,u,f;for(t in e)if(t!==i&&e[t]!==""){if(u=2,t==1&&(u=0),f=r.getColumns()[r.getColumnIndex(t)],n[f.field]==i)return!1;if(u==0){if(!n[f.field].toLowerCase().contains(e[t].toLowerCase()))return!1}else if(u==2&&n[f.field]!=e[t].toDecimal())return!1}return!0}function b(n,t,i){return'<div title="'+nonull(i)+'">'+nonull(i)+"<\/div>"}function l(n,t,i){return"<div>"+nonull(i)+"<\/div>"}function k(n,t,i,r,u){return"<div style='margin-top:-5px'><div class='chb' id='"+i+"' data-id='"+u.id+"'><\/div><\/div>"}function d(){var s,n,t,o,u,h,c,e,l,a,v;if(r!=i){for(s="Izvoz",n="",n+='<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40"><DocumentProperties xmlns="urn:schemas-microsoft-com:office:office"><Version>12.00<\/Version><\/DocumentProperties><ExcelWorkbook xmlns="urn:schemas-microsoft-com:office:excel"><ProtectStructure>False<\/ProtectStructure><ProtectWindows>False<\/ProtectWindows><\/ExcelWorkbook> ',n+="<Styles>",n+='<Style ss:ID="heder" ss:Name="heder"><Alignment ss:Vertical="Center" /><Font ss:Color="#FFFFFF" /><Interior ss:Color="#444444" ss:Pattern="Solid"/><\/Style>',n+='<Style ss:ID="totalTxt" ss:Name="totalTxt"><Alignment ss:Vertical="Center"/><Font ss:Color="#FFFFFF" /><Interior ss:Color="#444444" ss:Pattern="Solid"/><\/Style>',n+='<Style ss:ID="totalDecimal" ss:Name="totalDecimal"><Alignment ss:Vertical="Center" ss:Horizontal="Right"/><Font ss:Color="#FFFFFF" /><Interior ss:Color="#444444" ss:Pattern="Solid"/><\/Style>',n+='<Style ss:ID="bodyTxt" ss:Name="bodyTxt"><Alignment ss:Vertical="Center"/><\/Style>',n+='<Style ss:ID="bodyDecimal" ss:Name="bodyDecimal"><Alignment ss:Vertical="Center" ss:Horizontal="Right"/><\/Style>',n+="<\/Styles>",n+='<Worksheet ss:Name="Sheet1"><Table>',t=r.getColumns().filter(function(n){return n.id!=15}),o=0;o<t.length;o++)n+='<Column ss:AutoFitWidth="1" ss:Width="65"/>';for(n+="<Row>",u=0;u<t.length;u++)h=t[u],n+='<Cell ss:StyleID="heder"><Data ss:Type="String">'+h.name+"<\/Data><\/Cell>";n+="<\/Row>";c=f.filter(function(n){return n.ZaStampu});c.forEach(function(i){var r;for(n+="<Row>",r=0;r<t.length;r++){var u=t[r],e=i[u.field],f="Number";u.id==1&&(f="String");n+='<Cell ss:StyleID="bodyTxt"><Data ss:Type="'+f+'">'+nonull(e)+"<\/Data><\/Cell>"}n+="<\/Row>"});n+="<\/Table><\/Worksheet><\/Workbook>";e=document.createElement("a");e.download=s+".xls";l=new Blob([n],{type:"data:application/vnd.ms-excel"});a=URL.createObjectURL(l);e.href=a;v=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});e.dispatchEvent(v)}}function g(){var n=t(this),r;if(!n.hasClass("teloDugmeIskljuceno")){if(r=s.quiDate("getJSONDateNoTZStringify"),r==i){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),qKonverzija.VratiLokalizovaniTekst("Datum nije izabran."),"greska");return}o=[];n.addClass("teloDugmeIskljuceno");t.ajax({type:"GET",url:a,data:{datumJ:r},success:function(n){if(n.Greska){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),n.Poruka,"greska");return}p(n.Data)},complete:function(){n.removeClass("teloDugmeIskljuceno")}})}}function p(n){var s,p,a,d,v,g,nt,tt;if(c=n,f=[],n!=i&&n.AktivniPredmeti.length>0)for(f=n.AktivniPredmeti,s=0;s<f.length;++s)p=f[s],p.id=s,p.RedniBroj=s+1,p.ZaStampu=!0;for(a=[{field:"ZaStampu",name:qKonverzija.VratiLokalizovaniTekst(""),id:15,width:30,sortable:!1,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd",formatter:k,customPolje:!0},{field:"RedniBroj",name:qKonverzija.VratiLokalizovaniTekst("Redni broj"),id:0,width:75,sortable:!1,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd",formatter:l},{field:"Inspekcija",name:qKonverzija.VratiLokalizovaniTekst("Inspekcija"),id:1,width:300,sortable:!1,headerCssClass:"qTabelaHeadTd",cssClass:"qTabelaTd",formatter:b}],d=2,v=1;v<12;++v)g="NazivKolone"+v,o.push(n[g]),a.push({field:"Godina"+v,name:n[g],id:d,width:42,sortable:!1,headerCssClass:"qTabelaHeadTd "+n[g],cssClass:"qTabelaTd tar",formatter:l}),d++;a.push({field:"Ukupno",name:qKonverzija.VratiLokalizovaniTekst("Ukupno"),id:d,width:60,sortable:!1,headerCssClass:"qTabelaHeadTd ukupno",cssClass:"qTabelaTd tar",formatter:l});u=new Slick.Data.DataView;r=new Slick.Grid("#aktivniPredmetiSlickGrid",u,a,y);r.setSelectionModel(new Slick.RowSelectionModel);nt=new Slick.Controls.Pager(u,r,t("#aktivniPredmetiSlickGridPager"));tt=new Slick.Controls.ColumnPicker(a,r,y);u.onRowCountChanged.subscribe(function(){r.updateRowCount();r.render();h()});u.onRowsChanged.subscribe(function(n,i){r.invalidateRows(i.rows);r.render();h();t("#aktivniPredmetiSlickGrid").find(".chb").each(function(){var n=t(this);n.quiCheckBox({checked:n.attr("id")=="true"})})});t(r.getHeaderRow()).delegate(":input","change keyup",function(){var n=t(this).data("columnId");n!=null&&(e[n]=t.trim(t(this).val()),u.refresh())});r.onHeaderRowCellRendered.subscribe(function(n,i){if(t(i.node).empty(),i.column.id!=0&&i.column.id!=15){var r=t("<input type='text'>");r.data("columnId",i.column.id).val(e[i.column.id]);r.appendTo(i.node)}else t(i.node).addClass("no-filter");h()});r.onColumnsReordered.subscribe(function(){h()});r.onColumnsResized.subscribe(function(){t(".slick-header-columns.ui-sortable:eq(0)").find(".qTabelaHeadTd").each(function(n){t(".slick-footer-columns:eq(0)").find(".qTabelaHeadTd:eq("+n+")").width(t(this).width())})});r.onSort.subscribe(function(n,t){var r=function(n,r){var l=t.sortCol.field,e=t.sortAsc?1:-1,u=n[l],f=r[l],s,a,o,h,c;return u!=i&&f==i?1*e:u==i&&f!=i?-1*e:u==i&&f==i?0:(s=1,a=t.sortCol.id,a==1&&(s=0),s==1?o=(u==f?0:u>f?1:-1)*e:(h=u.toLowerCase(),c=f.toLowerCase(),o=(h==c?0:h>c?1:-1)*e),o!=0)?o:0};u.sort(r)});r.onScroll.subscribe(function(){t("#aktivniPredmetiSlickGrid").find(".chb").each(function(){var n=t(this);n.quiCheckBox({checked:n.attr("id")=="true"})})});r.init();u.beginUpdate();u.setItems(f);u.setFilter(w);u.endUpdate()}function h(){for(var f,n,s=t(".slick-footer-columns:eq(0)"),h=0,r=0;r<o.length;++r){var l=o[r],c=0,e="Godina"+(r+1);for(f=0;f<u.getLength();++f)n=u.getItem(f),n.hasOwnProperty(e)&&(c+=n[e]!=i?n[e]:0),r==0&&(h+=n.Ukupno!=i?n.Ukupno:0);s.find(".qTabelaHeadTd."+l+" span").text(c)}s.find(".qTabelaHeadTd.ukupno span").text(h)}function nt(){var r=t("#aktivniPredmetiBtnStampa").find("table"),n,u;if(!r.hasClass("teloDugmeIskljuceno")){if(n=s.quiDate("getJSONDateNoTZStringify"),n==i){PrikaziProzor(!0,!0,qKonverzija.VratiLokalizovaniTekst("GREŠKA"),dqKonverzija.VratiLokalizovaniTekst("Datum nije izabran."),"greska");return}c.AktivniPredmeti=f.filter(function(n){return n.ZaStampu});u={datumJ:n,vmJ:JSON.stringify(c)};qStampa.PrikaziDijalogStampe(v,u,!1,!1,"POST");r.removeClass("teloDugmeIskljuceno")}}var s,c,f=[],a,v,e={},r,u,o=[],y={editable:!1,enableCellNavigation:!0,showHeaderRow:!0,showFooterRow:!0,headerRowHeight:30,explicitInitialization:!0,rowHeight:20};n.Init=function(){var n=qUtils.IzvuciVM();e={};r=i;u=i;o=[];f=[];a=t("#url_VratiAktivnePredmete").text();v=t("#url_VratiStampeAktivnihPredmeta").text();s=t("#aktivniPredmetiDatum");s.quiDate({width:200,showX:!1});t("#aktivniPredmetiBtnPretrazi").click(g);t("#aktivniPredmetiBtnIzvoz").click(d);t("#aktivniPredmetiBtnStampa").click(nt);t(window).on("resize.slickgrid",function(){r!=i&&r.resizeCanvas();t("#aktivniPredmetiSlickGrid").find(".chb").each(function(){var n=t(this);n.quiCheckBox({checked:n.attr("id")=="true"})})});p(n);t("#aktivniPredmetiOznaciSve").quiCheckBox({checked:!0});t("#aktivniPredmetiSlickGrid").on("change",".chb",function(n,i){var f=t(this).attr("data-id"),r=u.getItemById(f);r.ZaStampu=i;t(this).attr("id",i);u.updateItem(r.id,r)});t("#aktivniPredmetiOznaciSve").on("change",function(n,i){f.forEach(function(n){n.ZaStampu=i});u.beginUpdate();u.setItems(f);u.endUpdate();r.invalidateAllRows();setTimeout(function(){t(window).trigger("resize")},1)})}}(window.qAktivniPredmeti=window.qAktivniPredmeti||{},jQuery);